<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GHL Funnel Engine + Live Preview</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .iphone-x {
            width: 375px; height: 667px;
            border: 12px solid #1e293b; border-radius: 40px;
            overflow: hidden; background: white;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: sticky; top: 20px;
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50">

<div class="flex h-screen overflow-hidden">
    <div class="w-2/5 p-8 overflow-y-auto border-r bg-white">
        <h1 class="text-2xl font-bold text-blue-600 mb-2">FunnelEngine Pro</h1>
        <p class="text-sm text-slate-500 mb-8">Customize your interactive quiz below.</p>

        <div class="space-y-6">
            <section class="p-4 bg-slate-50 rounded-xl">
                <h3 class="font-bold mb-3 text-sm uppercase text-slate-400">Branding</h3>
                <div class="flex gap-4">
                    <input type="color" id="primaryColor" value="#3b82f6" oninput="updatePreview()" class="h-10 w-12 rounded cursor-pointer">
                    <select id="animStyle" onchange="updatePreview()" class="flex-1 rounded border-slate-300 text-sm">
                        <option value="animate-slide">Slide Animation</option>
                        <option value="animate-fade">Fade Animation</option>
                    </select>
                </div>
            </section>

            <section>
                <div class="flex justify-between mb-2">
                    <h3 class="font-bold text-sm uppercase text-slate-400">Questions</h3>
                    <button onclick="addQuestion()" class="text-blue-600 text-xs font-bold">+ Add Step</button>
                </div>
                <div id="questions-container" class="space-y-4"></div>
            </section>
            
            <button onclick="copyFinalCode()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition">
                Copy GHL Code
            </button>
        </div>
    </div>

    <div class="w-3/5 bg-slate-200 flex flex-col items-center justify-center p-8 relative">
        <div class="mb-4 text-slate-500 font-medium text-sm flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> 
            Live Preview (Interactive)
        </div>
        
        <div class="iphone-x">
            <iframe id="preview-frame" class="w-full h-full border-none"></iframe>
        </div>

        <button onclick="updatePreview()" class="mt-6 text-xs bg-white px-4 py-2 rounded-full shadow-sm text-slate-600 hover:bg-slate-50">
            ðŸ”„ Refresh Preview
        </button>
    </div>
</div>

<script>
    let questionsCount = 0;

    // Initial Example Question
    function addQuestion() {
        questionsCount++;
        const id = `q_${questionsCount}`;
        const div = document.createElement('div');
        div.className = "p-4 bg-white border rounded-xl shadow-sm relative";
        div.innerHTML = `
            <input type="text" placeholder="Question Title" oninput="updatePreview()" class="q-title w-full font-bold text-sm mb-2 outline-none border-b focus:border-blue-400" value="Question ${questionsCount}">
            <textarea oninput="updatePreview()" placeholder="Option | Score | ImageURL" class="q-options w-full h-20 text-xs p-2 bg-slate-50 rounded font-mono">Option A | 5 | \nOption B | 10 | </textarea>
        `;
        document.getElementById('questions-container').appendChild(div);
        updatePreview();
    }

    function generateFullHTML() {
        const color = document.getElementById('primaryColor').value;
        const anim = document.getElementById('animStyle').value;
        
        // Collect Questions
        const qBlocks = document.querySelectorAll('#questions-container > div');
        const qArray = Array.from(qBlocks).map((block, i) => {
            const options = block.querySelector('.q-options').value.split('\n').filter(l => l.trim()).map(line => {
                const parts = line.split('|');
                return { text: parts[0]?.trim(), score: parseInt(parts[1]) || 0, img: parts[2]?.trim() || '', nextId: `step_${i+1}` };
            });
            return { id: `step_${i}`, question: block.querySelector('.q-title').value, options };
        });

        // This is the actual code that will run inside GHL and the Preview
        return `
            <html>
            <head>
                <script src="https://cdn.tailwindcss.com"><\/script>
                <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"><\/script>
                <style>
                    :root { --primary: ${color}; }
                    .opt-btn { width: 100%; padding: 12px; margin-bottom: 8px; border: 2px solid #eee; border-radius: 10px; text-align: left; transition: 0.2s; cursor: pointer; }
                    .opt-btn:hover { border-color: var(--primary); background: #f0f7ff; }
                    .${anim} { animation: in 0.4s ease forwards; }
                    @keyframes in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                </style>
            </head>
            <body class="p-6 font-sans">
                <div id="app"></div>
                let questionsCount = 0;      function addQuestion() {         questionsCount++;         const id = `q_${questionsCount}`;         const div = document.createElement('div');         div.className = "p-4 bg-white border rounded-xl shadow-sm relative mb-4";         div.innerHTML = `             <div class="flex justify-between items-center mb-2">                 <span class="text-xs font-bold text-blue-500 uppercase">Step ${questionsCount} (ID: step_${questionsCount-1})</span>                 <button onclick="this.parentElement.parentElement.remove(); updatePreview();" class="text-gray-300 hover:text-red-500">âœ•</button>             </div>             <input type="text" placeholder="Question Title" oninput="updatePreview()" class="q-title w-full font-bold text-sm mb-2 outline-none border-b focus:border-blue-400" value="Question ${questionsCount}">             <label class="block text-[10px] text-gray-400 font-bold uppercase">Options (Label | Score | Next Step ID | ImageURL)</label>             <textarea oninput="updatePreview()" placeholder="Option A | 5 | step_1 | https://..." class="q-options w-full h-24 text-xs p-2 bg-slate-50 rounded font-mono">Option 1 | 5 | next | 
Option 2 | 10 | next | </textarea>         `;         document.getElementById('questions-container').appendChild(div);         updatePreview();     }      function generateFullHTML() {         const color = document.getElementById('primaryColor').value;         const anim = document.getElementById('animStyle').value;         const webhook = document.getElementById('webhook').value || 'YOUR_WEBHOOK';                  const qBlocks = document.querySelectorAll('#questions-container > div');         const qArray = Array.from(qBlocks).map((block, i) => {             const options = block.querySelector('.q-options').value.split('
').filter(l => l.trim()).map(line => {                 const parts = line.split('|');                 let nextId = parts[2]?.trim() || 'next';                 if(nextId === 'next') nextId = `step_${i+1}`; // Default linear flow                  return {                      text: parts[0]?.trim(),                      score: parseInt(parts[1]) || 0,                      nextId: nextId,                     img: parts[3]?.trim() || ''                  };             });             return { id: `step_${i}`, question: block.querySelector('.q-title').value, options };         });          // FULL ENGINE CODE         return `             <html>             <head>                 <script src="https://cdn.tailwindcss.com"><\/script>                 <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"><\/script>                 <style>                     :root { --primary: ${color}; }                     .opt-btn { width: 100%; padding: 12px; margin-bottom: 8px; border: 2px solid #eee; border-radius: 10px; text-align: left; transition: 0.2s; cursor: pointer; display: flex; align-items: center; gap: 10px;}                     .opt-btn:hover { border-color: var(--primary); background: #f0f7ff; transform: translateY(-2px); }                     .opt-img { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }                     .${anim} { animation: in 0.4s ease forwards; }                     @keyframes in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }                     .input-ghl { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; }                 </style>             </head>             <body class="p-6 font-sans bg-white">                 <div id="app"></div>                  <script>                     const config = ${JSON.stringify(qArray)};                     let state = { currentId: 'step_0', score: 0, answers: {} };                      function render() {                         const app = document.getElementById('app');                         const step = config.find(s => s.id === state.currentId);                          if(!step) {                             showLeadForm();                             return;                         }                          app.innerHTML = \`                             <div class="${anim}">                                 <h2 class="text-xl font-bold mb-6">\${step.question}</h2>                                 \${step.options.map(o => \`                                     <div class="opt-btn" onclick="handleNext('\${o.nextId}', \${o.score}, '\${step.question}', '\${o.text}')">                                         \${o.img ? \\`<img src="\${o.img}" class="opt-img">\\` : ''}                                         <span>\${o.text}</span>                                     </div>                                 \`).join('')}                             </div>                         \`;                     }                      function handleNext(nextId, score, q, a) {                         state.score += score;                         state.answers[q] = a;                         state.currentId = nextId;                         render();                     }                      function showLeadForm() {                         document.getElementById('app').innerHTML = \`                             <div class="${anim}">                                 <h2 class="text-xl font-bold mb-4 text-center">Final Step!</h2>                                 <p class="text-gray-500 text-sm mb-4 text-center">Where should we send your results?</p>                                 <input id="email" type="email" class="input-ghl" placeholder="Email Address">                                 <button onclick="submit()" class="w-full bg-[${color}] text-white py-3 rounded-lg font-bold">Show My Results</button>                             </div>                         \`;                     }                      function submit() {                         document.getElementById('app').innerHTML = \`                             <div class="text-center mt-10">                                 <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_at6m9vtx.json" background="transparent" speed="1" style="width: 150px; height: 150px; margin:auto;" loop autoplay></lottie-player>                                 <p class="font-bold">Analyzing your answers...</p>                             </div>                         \`;                         setTimeout(() => {                             document.getElementById('app').innerHTML = \`                                 <div class="text-center mt-10">                                     <h2 class="text-2xl font-bold text-green-600">Success!</h2>                                     <p class="text-gray-600 mt-2">Your score was \${state.score}. We will contact you soon.</p>                                 </div>                             \`;                         }, 3000);                     }                      render();                 <\/script>             </body>             </html>         `;     }      function updatePreview() {         const frame = document.getElementById('preview-frame');         frame.srcdoc = generateFullHTML();     }      function copyFinalCode() {         navigator.clipboard.writeText(generateFullHTML());         alert("Code Copied for GHL!");     }      addQuestion(); // Start with one question </script>
                    const config = ${JSON.stringify(qArray)};
                    let current = 0;
                    function render() {
                        const step = config[current];
                        if(!step) { 
                            document.getElementById('app').innerHTML = "<h2 class='text-xl font-bold text-center mt-20'>Lead Form Ready!</h2>";
                            return; 
                        }
                        document.getElementById('app').innerHTML = \`
                            <div class="${anim}">
                                <h2 class="text-xl font-bold mb-6">\${step.question}</h2>
                                \${step.options.map(o => \`<div class="opt-btn" onclick="next()">\${o.text}</div>\`).join('')}
                            </div>
                        \`;
                    }
                    function next() { current++; render(); }
                    render();
                <\/script>
            </body>
            </html>
        `;
    }

    function updatePreview() {
        const frame = document.getElementById('preview-frame');
        const html = generateFullHTML();
        frame.srcdoc = html;
    }

    function copyFinalCode() {
        const code = generateFullHTML();
        navigator.clipboard.writeText(code);
        alert("GHL Code Copied!");
    }

    // Start
    addQuestion();
</script>
</body>
</html>
